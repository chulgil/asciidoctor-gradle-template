:stylesheet: ../@style/editor.css
include::../attribute.adoc[]

== Asciidoc から HTML/PDF 文書を作成する

=== サンプル文書の変換を試す

環境の準備ができましたので Asciidoc 文書を HTML/PDF に変換してみます。

変換に使うスクリプトは github のリポジトリに公開されており、リポジトリには HTML/PDF 変換に使うファイル一式と、文書サンプルとして "この文書" の Asciidoc ファイルが置かれています。まずはサンプル文書が正しく変換できるかを試してみましょう。

macOS / Linux の場合は次のようにします。

[source]
[caption="手順. "]
.PDF 変換ビルドスクリプトの取得と実行
----
$ curl -L -O https://github.com/h1romas4/asciidoctor-gradle-template/archive/master.zip # <1>
$ unzip master.zip # <2>
$ cd asciidoctor-gradle-template-master # <3>
$ ./gradlew docs # <4>
BUILD SUCCESSFUL in 19s <5>
2 actionable tasks: 2 executed
----

<1> リポジトリのファイルをダウンロードします。
<2> ダウンロードした .zip ファイルを展開します。
<3> カレントディレクトリを展開したフォルダの中に移します。
<4> Gradle のビルドを実行します。初回実行時はビルドに必要なファイルをダウンロードするため少し時間がかかります。次回は数秒で完了します。
<5> ``BUILD SUCCESSFUL`` が出力されればビルド成功です。

<<<

Windows をお使いの場合は同等の操作をブラウザとエクスプローラーを使って行います。

. ブラウザを使って ``https://github.com/h1romas4/asciidoctor-gradle-template/archive/master.zip`` にアクセスしリポジトリのファイルを取得します。
. ダウンロードした .zip ファイルを右クリックし展開します。
. 展開したフォルダ内をエクスプローラーで表示した上で、アドレスバーに ``cmd.exe`` と入力し、このフォルダをカレントディレクトリとしてコマンドプロンプトを起動します。
+
image::windows-01.png[windows, 480]

. ``.\gradlew.bat docs`` と入力し Gradle ビルドを実行します。初回実行時はビルドに必要なファイルをダウンロードするため少し時間がかかります。次回は数秒で完了します。
. ``BUILD SUCCESSFUL`` が出力されればビルド成功です。

.プロキシーサーバーの設定
****
もしお使いのコンピューターがプロキシーサーバー経由のインターネットアクセスを行う場合は、次のコマンドを ``./gradlew docs`` をする前に入力してください。インターネットを使ったライブラリの取得が正しく行われるようになります。ホスト名（``example.com``） と ポート番号（``8080``）部分はそれぞれの環境に合わせてください。

[source]
[caption="手順. "]
.プロキシーサーバー設定（Windows）
----
set JAVA_OPTS=-DproxyHost=example.com -DproxyPort=8080
----

[source]
[caption="手順. "]
.プロキシーサーバー設定（macOS / Linux）
----
export JAVA_OPTS=-DproxyHost=example.com -DproxyPort=8080
----
****

<<<

Asciidoc から変換された文書は次の場所に格納されます。

[source]
----
docs/index.html
docs/index.pdf
----

.PDF 文書
image::pdf.png[pdf, 520]

.HTML 文書
image::html.png[html, 520]

TIP: 文書を github 上に公開する場合は、プロジェクトのファイルを全てコミットし、GitHub Pages に ``docs`` フォルダを指定することで継続的に文書をパブリッシュすることができます。

=== テキストエディタで Asciidoc 文書を編集する

プロジェクトに配置された Asciidoc 文書は Visual Studio Code を利用してリアルタイムに変換結果をプレビューしながら編集できるように準備されています。

プロジェクトフォルダ（``asciidoctor-gradle-template-master``）を Visual Studio Code で開き、拡張機能の推奨事項から拡張を導入します。

NOTE: 拡張機能の推奨は ``.vscode/extention.json`` で設定されています。文書に応じて設定し、執筆メンバーの環境を揃えることができます。

. btn:[すべてインストール] ボタンをクリックします。
+
image::vscode-extention1.png[vscode]

. btn:[再読み込み] ボタンをクリックします。
+
image::vscode-extention2.png[vscode]

. Asciidoc 文書（``src/docs/asciidoc/index.adoc``など）を Visual Studio Code のエクスプローラーから選択して開き、文書を開いたエディタ部右上に配置された btn:[Open Preview to the Side]アイコンをクリックすると、画面右側に Asciidoc 文書の変換がリアルタイムに確認できるプレビューが表示されます。
+
image::vscode-asciidoc.png[vscode, 600]

なお、もしリアルタイムプレビューでソースコードのハイライトが動作しない場合は、Asciidoc 文書を開いた状態で btn:[F1] を押し、menu:Change Preview Security Setting[Disable] を選択してください。

image::vscode-asciidoc-security1.png[vscode]

image::vscode-asciidoc-security2.png[vscode]

[WARNING]
====
本設定は、プレビュー画面で動作する Webview がインターネット上の外部リソースを評価できるようにセキュリティー権限を下げる設定です。

プロジェクト（ファイルが配置されたフォルダ）毎の設定となりますが、この設定をした後はこのプロジェクトで第三者の作成した未知の Asciidoc 文書を開かないようにしてください。外部に配置された悪意の JavaScript により、セキュリティーを侵害される可能性があります。理解の上、設定してください。

拡張がソースコードのハイライトを行うため、CDN に配置されたリソースを参照しているために発生している問題で、将来ローカルのリソースを参照するように修正され解決されると思われます。
====
